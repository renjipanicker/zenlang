include Window public;
include Mainframe;
include Button;
include TextEdit;
include Menu;
include MenuItem;
include WindowCreator;

main MyMain {
    auto defn = MainFrame::Definition {
                name: @mainFrame;
                title     : "test";
                position  : Window::Position {x:10;y:10;w:400;h:200;};
                visible   : true;
                childList : [ pointer<Widget::Definition>,
                              &Menu::Definition {
                                name: @systrayMenu;
                                childList : [ pointer<Widget::Definition>,
                                              &MenuItem::Definition {
                                                  name  : @showItem;
                                                  label : "Show";
                                              },
                                              &MenuItem::Definition {
                                                  name  : @hideItem;
                                                  label : "Hide";
                                              },
                                              &MenuItem::Definition {
                                                  name  : @exitItem;
                                                  label : "Exit";
                                              },
                                          ];
                              },

                              &Systray::Definition {
                                name: @systray;
                                tooltip : "guiTest";
                                visible : true;
                              },

                              &Button::Definition {
                                name    : @checkBox;
                                title   : "Check";
                                position: Window::Position {x:10;y:10;w:60;h:22;};
                                left    : Window::Anchor {target:@parent;margin:10;};
                              },

                              &TextEdit::Definition {
                                name    : @outputBox;
                                title:"Output";
                                position:Window::Position{x:10;y:50;w:300;h:100;};
                                multiline:true;
                              }
                            ];
                };

    auto mainFrame = WindowCreator::Create(defn);

    auto checkBtn  = <Window::Handle>mainFrame.child@@checkBox;
    auto outputBox = <Window::Handle>mainFrame.child@@outputBox;

    auto sysTray     = <Systray::Handle>mainFrame.child@@systray;
    auto systrayMenu = <Menu::Handle>mainFrame.child@@systrayMenu;
    auto showMenu    = <MenuItem::Handle>systrayMenu.child@@showItem;

//    auto showMenu1 = <MenuItem::Handle>(mainFrame.child[@systray].child[@menu].child[@showItem]);
//    auto showMenu = mainFrame.child@@systray][@menu][@showItem];
//    auto showMenu = mainFrame@@systray@@menu@@showItem;

    Window::OnResize(mainFrame) => Window::OnResize::Handler {
        print "on resize\n";
        auto pp = Window::getWindowPosition(mainFrame);
        auto cp = Window::getChildPosition(outputBox);
        cp.w = pp.w - cp.x - 20;
        cp.h = pp.h - cp.y - 50;
        run Window::Move(outputBox, cp);
        return ();
    };

    Button::OnClick(checkBtn) => Button::OnClick::Handler {
        print "on click\n";
        TextEdit::AppendText(outputBox, "hello!\n");
        return ();
    };

    Systray::OnContextMenu(sysTray) => Systray::OnContextMenu::Handler {
        Menu::Show(systrayMenu);
    };

//    MenuItem::OnSelect(showMenu) => MenuItem::OnSelect::Handler {
//        print "on show\n";
//        return ();
//    };
    return (0);
}
