namespace TestBasic;

public routine int testNative(const string& s) native;

public routine int testRoutine(const int& x) {
    return 12345;
}

public function (int ri, string rs)testFunction(const int& x) {
    return (67890, "testfn");
}

public test testBasicExpr {
    local i = 0;
    local s = "xx";
    local e = (1 + 2) * 3;
    local n = (1 > 2) ? 1 : 2;
    local t = "yy %{x}\n" @ {"x":1};
    local l = [1,2,3];
    local d = ["a":1,"b":2,"c":3];
    local r = testRoutine(123);
    local f = testFunction(456);

    assert(i == 0, s == "xx", e == 9);

    return (1);
}

public enum MyEnum {
    C1;
    C2;
};

public struct MyStruct {
    i = 0;
};

public function (int r)testAdvancedExpr(const int& x, const MyStruct& myStruct, const MyEnum& myEnum) {
    local v = x;
    local m = myStruct.i;
    local n = myEnum;
    return (67890);
}

public test testFunction001 {
    local myStruct = MyStruct{i:0};
    local e = MyEnum.C1;
    local c = testAdvancedExpr(321, myStruct, e);
    return (1);
}

public test testInnerRootFunction {
    function (int i)innerFunction(int j) {
        return (2);
    }
    local f = innerFunction(2);
    local o = innerFunction[];
    local r = o(2);
    return (1);
}

public test testInnerChildFunction {
    testFunction innerFunction {
        return (2, "aa");
    }
    local f = innerFunction(2);
    local o = innerFunction[];
    local r = o(2);
    return (1);
}

public test testInnerChildFunctionClosure {
    local i = 0;
    testFunction innerFunction {
        return (i, "aa");
    }
    local f = innerFunction(2);
    local o = innerFunction[];
    local r = o(2);
    return (1);
}

public test testAnonymousFunction {
    local a = testFunction {
        return (2, "aa");
    };
    local r = a(2);
    return (1);
}

public test testAnonymousFunctionWithClosure {
    local i = 0;
    local a = testFunction {
        return (i, "aa");
    };
    local r = a(2);
    return (1);
}

public test testIfStatement {
    local i = 0;
    local j = 0;
    if(i > 2) {
        j = 3;
    }
    return (1);
}

public test testIfElseStatement {
    local i = 0;
    local j = 0;
    if(i > 2) {
        j = 3;
    } else {
        j = 5;
    }
    return (1);
}

public test testWhileStatement {
    local i = 0;
    while(i < 2) {
        i++;
    }
    return (1);
}

public test testDoWhileStatement {
    local i = 0;
    do {
        i++;
    } while(i < 2);
    return (1);
}

public test testForExprStatement {
    local j = 0;
    local i = 0;
    for(i = 0; i < 10; ++i) {
        j += i;
    }
    return (1);
}

public test testForInitStatement {
    local j = 0;
    for(local i = 0; i < 10; ++i) {
        j += i;
    }
    return (1);
}

public test testForeachListStatement {
    local j = 0;
    local l = [1,2,3];
    foreach(i in l) {
        j += i;
    }
    return (1);
}

public test testForeachDictStatement {
    local j = 0;
    local l = ['a':1, 'b':2,'c':3];
    foreach(k,v in l) {
        j += v;
        continue;
    }
    return (1);
}

public test testSwitchValueStatement {
    local j = 0;
    switch(j) {
        case 1: {
            break;
        }
        case 2: {
            break;
        }
        default: {
            break;
        }
    }
    return (1);
}

public test testSwitchExprStatement {
    local j = 0;
    switch {
        case j == 1: {
        }
        case j == 2: {
        }
        default: {
        }
    }
    return (1);
}

public function (int ri, string rs)runFunctionTest(const int& x) {
    print "runFunctionTest %{x}\n" @ {"x":x};
    return (67890, "run");
}

public test testRunExpr {
    local j = 0;
    local f = run runFunctionTest(456);
    return (1);
}
